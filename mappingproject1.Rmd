---
title: "Mapping for MT Project 1"
author: "Christopher Cebra"
date: "2/15/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Maps

```{r data load}
load("data/rejections.RData")
load("data/bikedata.RData")
```

```{r}
# find source for geographical data (lat & long) regarding stations
locData <- read.csv("https://gist.githubusercontent.com/since1968/e51c0f3d95e67bf49f74/raw/37a6c381df119b7463c8fd33fdfaa06427d9794f/bikeStations.csv")
colnames(stations) <- c("terminalName","locations")

#take those with matching terminalName
newStations<-merge(x=stations,y=locData,by="terminalName",all.x=TRUE)
newStations<-newStations[, c("terminalName", "locations", "lat", "long")]
```

After the merge, some of the locations do not match (excluding those wherein the order of the street names were simply switched such as "Pentagon City Metro / 12th & S Hayes St" vs "12th & Hayes St /  Pentagon City Metro"). For these pairs of locations that do not match at all, we resorted to verifying the latitude and longitude for the location listed in `stations`, a data object provided from the Group Project 1 instructions. Latitude and longitude for these locations were gathered from inputting location names into Google Maps.

The 5 terminals with different locations are: 31000, 31500, 31302, 31609, 31239
```{r}
newStations[1,3] <- 38.85979; newStations[1,4] <- -77.05357
newStations[78,3] <- 38.90567; newStations[78,4] <- -77.04120 
newStations[1,3] <- 38.93465; newStations[1,4] <--77.07246
newStations[1,3] <- 38.91930; newStations[1,4] <- -77.00056
newStations[1,3] <- 38.87863; newStations[1,4] <- -77.02283
```

```{r make dataframes with rejections}
routes = cbind(routes,route_rejects_standard,route_rejects_standard_inverse,route_rejects_storey,route_rejects_storey_inverse)
routes = routes[(routes$station_start != routes$station_end),]
library(dplyr)
startStations = newStations
startStations$station_start = as.numeric(startStations$terminalName)
endStations = newStations
endStations$station_end = as.numeric(endStations$terminalName)
routes_ss = left_join(routes,startStations,by = "station_start")
routes_se = left_join(routes_ss,endStations,by = "station_end")
routes_cleaned = routes_se[c(3,4,5,6,9,10,13,14)]
routes_BH = routes_cleaned[routes_cleaned$route_rejects_standard == 1, c(5:8)]
routes_BH_inv = routes_cleaned[routes_cleaned$route_rejects_standard_inverse == 1, c(5:8)]
routes_Storey = routes_cleaned[routes_cleaned$route_rejects_storey == 1, c(5:8)]
routes_Storey_inv = routes_cleaned[routes_cleaned$route_rejects_storey_inverse == 1, c(5:8)]
```

```{r plot map}
library(ggplot2)
library(ggmap)
#usMap <- borders("state", colour="grey", fill="white")
#ggplot() + usMap
bbox <- c(left = -77.1, bottom = 38.85, right = -76.95, top = 38.95)
#DC <- ggmap(get_stamenmap(bbox, zoom = 13))
allUSA <- ggmap(get_stamenmap(bbox, zoom = 13)) +
  geom_curve(data=routes_BH,
             aes(x=long.x, y=lat.x, xend=long.y, yend=lat.y),
             col="#00008b",
             size=.2,
             curvature=0.2) +
  geom_point(data=routes_BH,
             aes(x=long.x, y=lat.x),
             colour="blue",
             size=0.2) +
  geom_point(data=routes_BH,
             aes(x=long.y, y=lat.y),
             colour="blue", size=0.2) +
  theme(axis.line=element_blank(),
        axis.text.x=element_blank(),
        axis.text.y=element_blank(),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.ticks=element_blank(),
        plot.title=element_text(hjust=0.5, size=12)) +
  coord_cartesian(ylim=c(38.85, 38.95), xlim=c(-77.1, -76.95)) +
  ggtitle("BH Procedure Significant Routes")
allUSA
```


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
